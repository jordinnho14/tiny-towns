(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const s={WOOD:"WOOD",WHEAT:"WHEAT",BRICK:"BRICK",GLASS:"GLASS",STONE:"STONE",NONE:"NONE"},T={COTTAGE:"COTTAGE",TAVERN:"TAVERN",BARRETT_CASTLE:"BARRETT_CASTLE"};class V{amount;constructor(e){this.amount=e}getFedPositions(e,t,n){return Array(this.amount).fill({r:-1,c:-1})}}class J{getFedPositions(e,t,n){const o=[];return[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([a,d])=>{const c=e+a,l=t+d;c>=0&&c<4&&l>=0&&l<4&&o.push({r:c,c:l})}),o}}class x{getFedPositions(e,t,n){const a=new Set,d=[],c=(l,h)=>{const p=n[l][h];return p===T.COTTAGE||p===T.BARRETT_CASTLE};for(let l=0;l<4;l++)for(let h=0;h<4;h++){const p=`${l},${h}`;if(a.has(p)||!c(l,h))continue;const f=[],O=[{r:l,c:h}];for(a.add(p);O.length>0;){const S=O.pop();f.push(S);const C=[[-1,0],[1,0],[0,-1],[0,1]];for(const[R,b]of C){const u=S.r+R,m=S.c+b,g=`${u},${m}`;u>=0&&u<4&&m>=0&&m<4&&!a.has(g)&&c(u,m)&&(a.add(g),O.push({r:u,c:m}))}}d.push(f)}return d.length===0?[]:(d.sort((l,h)=>h.length-l.length),d[0])}}class Q{getFedPositions(e,t,n){const o=[];for(let r=0;r<4;r++)r!==t&&o.push({r:e,c:r});for(let r=0;r<4;r++)r!==e&&o.push({r,c:t});return o}}class W{points;requiresFood;constructor(e,t=!1){this.points=e,this.requiresFood=t}score(e){return this.requiresFood&&!e.fedState?0:this.points}}class X{targetTypes;pointsPerNeighbor;constructor(e,t){this.targetTypes=e,this.pointsPerNeighbor=t}score(e){let t=0;const n=[[-1,0],[1,0],[0,-1],[0,1]];for(const[o,r]of n){const a=e.row+o,d=e.col+r;if(a>=0&&a<4&&d>=0&&d<4){const c=e.grid[a][d];this.targetTypes.includes(c)&&(t+=this.pointsPerNeighbor)}}return t}}class Z{score(e){const t=new Set;for(let n=0;n<4;n++)n!==e.col&&this.addIfBuilding(t,e.grid[e.row][n]);for(let n=0;n<4;n++)n!==e.row&&this.addIfBuilding(t,e.grid[n][e.col]);return t.size}addIfBuilding(e,t){["NONE","WOOD","WHEAT","BRICK","GLASS","STONE"].includes(t)||e.add(t)}}class ee{score(e){let t=0;return Object.values(e.counts).forEach(n=>{n===1&&(t+=1)}),t}}class te{multiplier;constructor(e){this.multiplier=e}score(e){const t=new Set,n=[[-1,0],[1,0],[0,-1],[0,1]],o=["NONE","WOOD","WHEAT","BRICK","GLASS","STONE"];for(const[r,a]of n){const d=e.row+r,c=e.col+a;if(d>=0&&d<4&&c>=0&&c<4){const l=e.grid[d][c];o.includes(l)||t.add(l)}}return t.size*this.multiplier}}class ne{score(e){const t=`${e.row},${e.col}`,n=e.metadata.get(t);return n&&n.savedScore||0}}class se{score(e){let t=0;for(const n of e.validBuildingNames){const o=n.toUpperCase();e.counts[o]||t++}return t*2}}class oe{score(e){let t=0;const n=new Set,o=["NONE","WOOD","WHEAT","BRICK","GLASS","STONE"],r=[[-1,0],[1,0],[0,-1],[0,1]];for(let a=0;a<4;a++)for(let d=0;d<4;d++){const c=`${a},${d}`,l=e.grid[a][d];if(n.has(c)||o.includes(l))continue;let h=0;const p=[{r:a,c:d}];for(n.add(c);p.length>0;){const f=p.pop();h++;for(const[O,S]of r){const C=f.r+O,R=f.c+S,b=`${C},${R}`;C>=0&&C<4&&R>=0&&R<4&&!n.has(b)&&e.grid[C][R]===l&&(n.add(b),p.push({r:C,c:R}))}}h>t&&(t=h)}return 1+t}}class re{score(e){let t=0;for(let n=0;n<4;n++)for(let o=0;o<4;o++){const r=e.grid[n][o],a=`${n},${o}`;r==="COTTAGE"&&(e.allFedPositions.has(a)||t++)}return t*3}}class ie{targetTypes;scoreAmount;constructor(e,t){this.targetTypes=e,this.scoreAmount=t}score(e){const t=[[-1,0],[1,0],[0,-1],[0,1]];for(const[n,o]of t){const r=e.row+n,a=e.col+o;if(r>=0&&r<4&&a>=0&&a<4){const d=e.grid[r][a];if(this.targetTypes.includes(d))return this.scoreAmount}}return 0}}class H{targetCategories;scoreAmount;constructor(e,t){this.targetCategories=e,this.scoreAmount=t}score(e){const t=[[-1,0],[1,0],[0,-1],[0,1]];for(const[n,o]of t){const r=e.row+n,a=e.col+o;if(r>=0&&r<4&&a>=0&&a<4){const d=e.grid[r][a],c=e.registry.find(l=>l.name.toUpperCase()===d.toUpperCase());if(c&&this.targetCategories.includes(c.type))return this.scoreAmount}}return 0}}class ce{score(e){let t=0;const n=e.grid[e.row][e.col];for(let o=0;o<4;o++)o!==e.col&&e.grid[e.row][o]===n&&t++;for(let o=0;o<4;o++)o!==e.row&&e.grid[o][e.col]===n&&t++;return t}}class ae{score(e){let t=1;const n=["1,1","1,2","2,1","2,2"],o=`${e.row},${e.col}`,r=e.grid[e.row][e.col];return n.forEach(a=>{if(a===o)return;const[d,c]=a.split(",").map(Number);e.grid[d][c]===r&&t++}),t}}const P={name:"Cottage",type:"BLUE",pattern:[[s.NONE,s.WHEAT],[s.BRICK,s.GLASS]],scorer:new W(3,!0),feedCost:1,description:"3 points if fed."},le=[P],de={name:"Farm",type:"RED",pattern:[[s.WHEAT,s.WHEAT],[s.WOOD,s.WOOD]],feeder:new V(4),description:"Feeds 4 cottages anywhere on the board."},ue={name:"Granary",type:"RED",pattern:[[s.WHEAT,s.WHEAT],[s.WOOD,s.BRICK]],feeder:new J,description:"Feeds all buildings in the 8 squares surrounding it."},pe={name:"Greenhouse",type:"RED",pattern:[[s.WHEAT,s.GLASS],[s.WOOD,s.WOOD]],feeder:new x,description:"Feeds one contiguous group of Cottages."},he={name:"Orchard",type:"RED",description:"Feeds Cottages in the same row and column.",pattern:[[s.STONE,s.WHEAT],[s.WHEAT,s.WOOD]],feeder:new Q},k=[de,ue,pe,he],me={name:"Well",type:"GRAY",pattern:[[s.WOOD,s.STONE]],description:"1 point for each adjacent cottage.",scorer:new X([T.COTTAGE,T.BARRETT_CASTLE],1)},fe={name:"Fountain",type:"GRAY",description:"2 points if adjacent to a Cottage.",pattern:[[s.WOOD,s.STONE]],scorer:new ie([T.COTTAGE,T.BARRETT_CASTLE],2)},Ee={name:"Millstone",type:"GRAY",description:"2 points if adjacent to a Red or Yellow building.",pattern:[[s.WOOD,s.STONE]],scorer:new H(["RED","YELLOW"],2)},ge={name:"Shed",type:"GRAY",description:"Worth 1 point. (Standard placement rules apply).",pattern:[[s.WOOD,s.STONE]],scorer:new W(1)},$=[me,fe,Ee,ge],Oe={name:"Tavern",type:"GREEN",pattern:[[s.BRICK,s.BRICK,s.GLASS]],description:"Score increasing points for each Tavern you have built."},F=[Oe],Ne={name:"Theater",type:"YELLOW",pattern:[[s.NONE,s.STONE,s.NONE],[s.WOOD,s.GLASS,s.WOOD]],scorer:new Z,description:"1 point for each unique building type in the same row and column."},Se={name:"Bakery",type:"YELLOW",description:"3 points if adjacent to a Food (Red) building.",pattern:[[s.NONE,s.WHEAT,s.NONE],[s.BRICK,s.GLASS,s.BRICK]],scorer:new H(["RED"],3)},ye={name:"Market",type:"YELLOW",description:"1 point for each other Market in the same row or column.",pattern:[[s.NONE,s.WOOD,s.NONE],[s.STONE,s.GLASS,s.STONE]],scorer:new ce},Ce={name:"Tailor",type:"YELLOW",description:"1 point. +1 point for each other Tailor in the 4 center squares.",pattern:[[s.NONE,s.WHEAT,s.NONE],[s.STONE,s.GLASS,s.STONE]],scorer:new ae},K=[Ne,Se,ye,Ce],Te={name:"Factory",type:"BLACK",pattern:[[s.WOOD,s.NONE,s.NONE,s.NONE],[s.BRICK,s.STONE,s.STONE,s.BRICK]],description:"Place 1 resource on the factory, whenever another player chooses that resource, play a different one instead."},_=[Te],Ae={name:"Chapel",type:"ORANGE",pattern:[[s.NONE,s.NONE,s.GLASS],[s.STONE,s.GLASS,s.STONE]],description:"Scores 1 point for each fed cottage."},q=[Ae],Re={name:"Archive",type:"PURPLE",pattern:[[s.WHEAT,s.WHEAT],[s.BRICK,s.GLASS]],scorer:new ee,isMonument:!0},Le={name:"Barrett Castle",type:"PURPLE",pattern:[[s.WHEAT,s.NONE,s.NONE,s.STONE],[s.WOOD,s.GLASS,s.GLASS,s.BRICK]],scorer:new W(5,!0),feedCost:1,countsAs:[T.COTTAGE],isMonument:!0},be={name:"Obelisk of the Crescent",type:"PURPLE",pattern:[[s.WHEAT,s.NONE,s.NONE],[s.BRICK,s.GLASS,s.BRICK]],isMonument:!0},Be={name:"Mandras",type:"PURPLE",pattern:[[s.WHEAT,s.GLASS],[s.BRICK,s.WOOD]],scorer:new te(2),isMonument:!0},Me={name:"Shrine of the Elder Tree",type:"PURPLE",pattern:[[s.BRICK,s.WHEAT,s.STONE],[s.WOOD,s.GLASS,s.WOOD]],isMonument:!0,scorer:new ne},we={name:"Baths",type:"PURPLE",pattern:[[s.NONE,s.WHEAT,s.NONE],[s.STONE,s.GLASS,s.WOOD],[s.BRICK,s.NONE,s.BRICK]],isMonument:!0,scorer:new se},Ie={name:"Forum",type:"PURPLE",pattern:[[s.NONE,s.NONE,s.WHEAT,s.NONE],[s.BRICK,s.BRICK,s.STONE,s.WOOD]],isMonument:!0,scorer:new oe},Ge={name:"Mausoleum",type:"PURPLE",pattern:[[s.WOOD,s.WOOD],[s.BRICK,s.STONE]],isMonument:!0,scorer:new re},We={name:"Cathedral",type:"PURPLE",pattern:[[s.NONE,s.WHEAT],[s.STONE,s.GLASS]],isMonument:!0,scorer:new W(2,!1)},ve=[Re,Le,be,Be,Me,we,Ie,Ge,We],G=[...le,...k,...$,...F,...K,..._,...q,...ve];class D{grid;size=4;metadata=new Map;constructor(){this.grid=Array(this.size).fill(null).map(()=>Array(this.size).fill(s.NONE))}place(e,t,n){if(!this.isValid(e,t))throw new Error(`Invalid coordinate: ${e}, ${t}`);if(this.grid[e][t]!==s.NONE)throw new Error("Spot already occupied");this.grid[e][t]=n}constructBuilding(e,t,n,o){if(!e.some(a=>a.row===t&&a.col===n)&&this.grid[t][n]!=="NONE")throw new Error("Building must be placed on one of the pattern squares.");this.clear(e),this.grid[t][n]=o}clear(e){e.forEach(({row:t,col:n})=>{this.isValid(t,n)&&(this.grid[t][n]=s.NONE,this.metadata.delete(`${t},${n}`))})}getGrid(){return this.grid.map(e=>[...e])}isValid(e,t){return e>=0&&e<this.size&&t>=0&&t<this.size}remove(e,t){this.isValid(e,t)&&(this.grid[e][t]="NONE",this.metadata.delete(`${e},${t}`))}setMetadata(e,t,n){this.metadata.set(`${e},${t}`,n)}getMetadata(e,t){return this.metadata.get(`${e},${t}`)}}class De{static rotate(e){return e[0].map((t,n)=>e.map(o=>o[n]).reverse())}static flip(e){return e.map(t=>[...t].reverse())}static getSymmetries(e){const t=new Set;let n=e;for(let o=0;o<4;o++)t.add(JSON.stringify(n)),t.add(JSON.stringify(this.flip(n))),n=this.rotate(n);return Array.from(t).map(o=>JSON.parse(o))}static findMatches(e,t){const n=this.getSymmetries(t.pattern),o=[];for(const r of n){const a=r.length,d=r[0].length;for(let c=0;c<=4-a;c++)for(let l=0;l<=4-d;l++)this.isMatch(e,r,c,l)&&o.push({row:c,col:l,pattern:r})}return o}static isMatch(e,t,n,o){return t.every((r,a)=>r.every((d,c)=>d==="NONE"?!0:e[n+a][o+c]===d))}}class Ue{static calculateScore(e,t,n){const a={},d=u=>n.find(m=>m.name.toUpperCase()===u.toUpperCase()),c={};let l=0,h=0;const p=new Set;for(let u=0;u<4;u++)for(let m=0;m<4;m++){const g=e[u][m];if(!this.isBuilding(g)){l++;continue}c[g]=(c[g]||0)+1;const y=d(g);if(y&&y.feeder){const A=y.feeder.getFedPositions(u,m,e);A.length>0&&A[0].r===-1?h+=A.length:A.forEach(L=>p.add(`${L.r},${L.c}`))}}const f=new Set;let O=0;for(let u=0;u<4;u++)for(let m=0;m<4;m++){const g=e[u][m];if(!this.isBuilding(g))continue;const y=d(g);if(y&&y.feedCost){const A=`${u},${m}`;let L=!1;p.has(A)?L=!0:h>=y.feedCost&&(h-=y.feedCost,L=!0),L&&(f.add(A),g===T.COTTAGE&&O++,g===T.BARRETT_CASTLE&&(O+=2))}}const S=n.map(u=>u.name);for(let u=0;u<4;u++)for(let m=0;m<4;m++){const g=e[u][m];if(!this.isBuilding(g))continue;const y=d(g);if(y)if(y.scorer){const A={grid:e,row:u,col:m,counts:c,fedState:f.has(`${u},${m}`),metadata:t,validBuildingNames:S,allFedPositions:f,registry:n},L=y.scorer.score(A);a[g]=(a[g]||0)+L}else y.type==="ORANGE"&&(a[g]=(a[g]||0)+O)}if(c[T.TAVERN]){const u=[0,2,5,9,14,20],m=Math.min(c[T.TAVERN],5);a[T.TAVERN]=u[m]}let C=0;Object.values(a).forEach(u=>C+=u);const b=(c.CATHEDRAL||0)>0?0:l;return{total:C-b,breakdown:a,penaltyCount:b}}static isBuilding(e){return!["NONE","WOOD","WHEAT","BRICK","GLASS","STONE"].includes(e)}}class He{board;currentResource=null;availableMatches=[];activeMonument=null;gameRegistry=[];lastMove=null;constructor(){this.board=new D}start(){if(this.board=new D,this.currentResource=null,this.lastMove=null,this.availableMatches=[],this.gameRegistry.length===0){const e=G.filter(n=>n.isMonument),t=G.filter(n=>!n.isMonument);this.activeMonument=e[Math.floor(Math.random()*e.length)],this.gameRegistry=[...t,this.activeMonument]}}placeResource(e,t){if(!this.currentResource)throw new Error("No resource selected");this.board.place(e,t,this.currentResource),this.lastMove={r:e,c:t},this.currentResource=null,this.scanForMatches()}constructBuilding(e,t,n){const o=[];let r=0,a=!1;if(e.pattern.forEach((d,c)=>{d.forEach((l,h)=>{l&&l!=="NONE"&&o.push({row:e.row+c,col:e.col+h})})}),e.buildingName.toUpperCase()==="SHRINE OF THE ELDER TREE"){a=!0;const c=this.countBuildingsOnBoard()+1;c<6?r=c:r=8}this.board.constructBuilding(o,t,n,e.buildingName),a&&this.board.setMetadata(t,n,{savedScore:r}),this.lastMove=null,this.scanForMatches()}undo(){this.lastMove&&(this.board.remove(this.lastMove.r,this.lastMove.c),this.lastMove=null,this.scanForMatches())}canUndo(){return this.lastMove!==null}scanForMatches(){this.availableMatches=[];const e=this.board.getGrid(),t=e.some(n=>n.some(o=>this.gameRegistry.find(a=>a.name.toUpperCase()===o.toUpperCase())?.isMonument));for(const n of this.gameRegistry){if(t&&n.isMonument)continue;De.findMatches(e,n).forEach(r=>{this.availableMatches.push({...r,buildingName:n.name.toUpperCase()})})}}checkGameOver(){const t=this.board.getGrid().some(o=>o.some(r=>r==="NONE")),n=this.availableMatches.length>0;return!t&&!n}getScore(){return Ue.calculateScore(this.board.getGrid(),this.board.metadata,this.gameRegistry)}countBuildingsOnBoard(){const e=this.board.getGrid();let t=0;const n=["WOOD","WHEAT","BRICK","GLASS","STONE","NONE"];return e.forEach(o=>{o.forEach(r=>{n.includes(r)||t++})}),t}hasObeliskAbility(){return this.board.getGrid().some(t=>t.some(n=>n.toUpperCase().includes("OBELISK")))}}class Pe{boardEl=document.getElementById("board");buildMenuEl=document.getElementById("build-menu");msgLabel=document.getElementById("message");paletteEl=document.getElementById("resource-palette");scoreEl=document.getElementById("score-display");undoBtn=document.getElementById("undo-btn");deckDisplayEl=document.getElementById("deck-display");onCellClick=()=>{};onResourceSelect=()=>{};onBuildClick=()=>{};onCancelClick=()=>{};constructor(){}render(e,t,n){this.renderHeader(e),this.renderBoard(e,t,n),this.renderSidebar(e,t),this.renderControls(e,t)}renderHeader(e){const t=e.getScore(),n=t.total+t.penaltyCount;this.scoreEl.innerHTML=`Score: ${n} <span style="font-size:12px; color:#999">(-${t.penaltyCount} empty)</span>`}renderBoard(e,t,n){const o=e.hasObeliskAbility(),r=e.board.getGrid(),a=["WOOD","WHEAT","BRICK","GLASS","STONE"];this.boardEl.children.length===0&&r.forEach((c,l)=>{c.forEach((h,p)=>{const f=document.createElement("div");f.dataset.r=l.toString(),f.dataset.c=p.toString(),f.onclick=()=>this.onCellClick(l,p),this.boardEl.appendChild(f)})}),Array.from(this.boardEl.children).forEach(c=>{const l=parseInt(c.dataset.r),h=parseInt(c.dataset.c),p=r[l][h];if(c.className="cell",c.style.backgroundColor="",p==="NONE")c.classList.add("empty"),c.textContent="";else if(a.includes(p))c.classList.add(p),c.textContent=p;else{c.textContent="";const f=e.gameRegistry.find(O=>O.name.toUpperCase()===p.toUpperCase());if(f){if(c.classList.add("constructed"),f.isMonument)c.classList.add("MONUMENT");else{const O=p.replace(/ /g,"-").replace(/'/g,"").toUpperCase();c.classList.add(O)}c.style.backgroundColor=f.color}}t&&(n.some(S=>S.row===l&&S.col===h)||o&&p==="NONE")&&c.classList.add("match-highlight"),p==="NONE"&&e.currentResource&&!t?(c.onmouseenter=()=>{c.classList.add("ghost",e.currentResource)},c.onmouseleave=()=>{c.classList.remove("ghost","WOOD","WHEAT","BRICK","GLASS","STONE")}):(c.onmouseenter=null,c.onmouseleave=null)}),t?(this.msgLabel.textContent=`Select a highlighted square to build your ${t.buildingName}!`,this.msgLabel.style.color="#d32f2f"):e.availableMatches.length>0?(this.msgLabel.textContent="Matches available!",this.msgLabel.style.color="#333"):e.currentResource?(this.msgLabel.textContent=`Place ${e.currentResource}...`,this.msgLabel.style.color="#333"):(this.msgLabel.textContent="Select a Resource...",this.msgLabel.style.color="#1976d2")}renderSidebar(e,t){if(this.buildMenuEl.innerHTML="",e.availableMatches.length===0){const n=document.createElement("p");n.textContent="No patterns found.",n.style.color="#777",n.style.fontStyle="italic",this.buildMenuEl.appendChild(n)}else e.availableMatches.forEach(n=>{const o=document.createElement("button");o.textContent=`Build ${n.buildingName}`;const r=n.buildingName.replace(/ /g,"-").replace(/'/g,"").toUpperCase();o.className=`build-btn ${r}`,o.onclick=()=>this.onBuildClick(n);const a=[];n.pattern&&Array.isArray(n.pattern)?n.pattern.forEach((d,c)=>{d.forEach((l,h)=>{l&&l!=="NONE"&&a.push({row:n.row+c,col:n.col+h})})}):a.push({row:n.row,col:n.col}),o.onmouseenter=()=>this.togglePreview(a,!0),o.onmouseleave=()=>this.togglePreview(a,!1),this.buildMenuEl.appendChild(o)});if(t){const n=document.createElement("button");n.textContent="Cancel Construction",n.className="secondary-btn",n.style.marginTop="10px",n.style.width="100%",n.onclick=()=>this.onCancelClick(),this.buildMenuEl.appendChild(n)}}togglePreview(e,t){e.forEach(n=>{const o=`div[data-r="${n.row}"][data-c="${n.col}"]`,r=this.boardEl.querySelector(o);r&&(t?r.classList.add("preview-target"):r.classList.remove("preview-target"))})}renderControls(e,t){this.paletteEl.innerHTML="",[s.WOOD,s.WHEAT,s.BRICK,s.GLASS,s.STONE].forEach(o=>{const r=document.createElement("div");let a=`res-btn ${o}`;e.currentResource===o&&!t&&(a+=" selected"),r.className=a,r.textContent=o.charAt(0),r.onclick=()=>this.onResourceSelect(o),this.paletteEl.appendChild(r)}),e.canUndo()&&!t?this.undoBtn.removeAttribute("disabled"):this.undoBtn.setAttribute("disabled","true")}renderDeck(e){this.deckDisplayEl&&(this.deckDisplayEl.innerHTML="",e.forEach(t=>{const n=document.createElement("div");t.isMonument?n.className="building-card MONUMENT":n.className=`building-card ${t.name.toUpperCase()}`;const o=document.createElement("header");o.className="card-header";const r=document.createElement("span");r.textContent=t.name;const a=document.createElement("div"),d=t.name.replace(/ /g,"-").replace(/'/g,"").toUpperCase();a.className=`card-icon ${d}`,o.appendChild(r),o.appendChild(a),n.appendChild(o);const c=document.createElement("div");c.className="card-body";const l=document.createElement("div");l.className="mini-pattern";const h=t.pattern[0].length;l.style.gridTemplateColumns=`repeat(${h}, 15px)`,t.pattern.forEach(f=>{f.forEach(O=>{const S=document.createElement("div"),C=O==="NONE"?"pattern-empty":O;S.className=`pattern-cell ${C}`,l.appendChild(S)})});const p=document.createElement("div");p.className="card-text",p.textContent=t.description||"Unique scoring rules.",c.appendChild(l),c.appendChild(p),n.appendChild(c),this.deckDisplayEl.appendChild(n)}))}}const N=new He,I=new Pe;let B=null,v=[];const E={startModal:document.getElementById("start-screen-modal"),startBtn:document.getElementById("start-game-btn"),restartBtn:document.getElementById("restart-btn"),undoBtn:document.getElementById("undo-btn"),monumentGrid:document.getElementById("monument-pattern-grid"),monumentSelect:document.getElementById("monument-selector"),monumentDesc:document.getElementById("monument-desc"),gameOverModal:document.getElementById("game-over-modal"),finalScore:document.getElementById("final-score"),scoreList:document.getElementById("score-breakdown-list")};I.onResourceSelect=i=>{B||(N.currentResource=i,M())};I.onBuildClick=i=>{B=i,v=Fe(i),M()};I.onCellClick=(i,e)=>{try{B?ke(i,e):$e(i,e)}catch(t){alert(t.message)}};I.onCancelClick=()=>{Y(),M()};E.undoBtn.onclick=()=>{N.undo(),M()};E.startBtn.onclick=()=>{const i=[];if(i.push(P),i.push(w(k)),i.push(w($)),i.push(w(K)),i.push(w(F)),i.push(w(_)),i.push(w(q)),N.activeMonument)i.push(N.activeMonument);else{console.warn("No monument selected, picking random.");const e=G.filter(t=>t.isMonument);i.push(e[0])}N.gameRegistry=i,N.start(),E.startModal.classList.add("hidden"),M(),I.renderDeck(N.gameRegistry)};E.restartBtn.onclick=()=>{E.gameOverModal.classList.add("hidden"),j()};function ke(i,e){const t=v.some(o=>o.row===i&&o.col===e),n=N.hasObeliskAbility()&&N.board.getGrid()[i][e]==="NONE";(t||n)&&(N.constructBuilding(B,i,e),Y(),M(),z())}function $e(i,e){if(!N.currentResource){alert("Select a resource first!");return}N.placeResource(i,e),M(),z()}function Y(){B=null,v=[]}function Fe(i){const e=[];return i.pattern.forEach((t,n)=>{t.forEach((o,r)=>{o!=="NONE"&&e.push({row:i.row+n,col:i.col+r})})}),e}function w(i){if(!i||i.length===0)throw new Error("Empty building list!");return i[Math.floor(Math.random()*i.length)]}function M(){I.render(N,B,v)}function j(){const i=G.filter(t=>t.isMonument);E.monumentSelect.innerHTML="",i.forEach((t,n)=>{const o=document.createElement("option");o.value=n.toString(),o.textContent=t.name,E.monumentSelect.appendChild(o)}),E.monumentSelect.onchange=()=>{const t=i[parseInt(E.monumentSelect.value)];N.activeMonument=t,Ke(t)};const e=Math.floor(Math.random()*i.length);E.monumentSelect.value=e.toString(),E.monumentSelect.onchange(null),E.startModal.classList.remove("hidden")}function Ke(i){E.monumentSelect.className=`monument-select ${i.name.toUpperCase()}`;const e={Archive:"1pt for every unique building type.","Barrett Castle":"Feeds 2 cottages. Worth 5pts.",Mandras:"2pts per unique adjacent neighbor.","Obelisk of the Crescent":"ABILITY: Can place buildings anywhere.","Shrine of the Elder Tree":"Score depends on when you build it (1-8pts).",Baths:"2pts for every building type NOT in your town.",Forum:"1pt + size of largest group of identical buildings.",Mausoleum:"Unfed cottages score 3pts.",Cathedral:"2pts. Empty spaces are worth 0."};E.monumentDesc.textContent=e[i.name]||"A unique monument.",_e(i)}function _e(i){E.monumentGrid.innerHTML="";const e=i.pattern;E.monumentGrid.style.gridTemplateColumns=`repeat(${e[0].length}, 30px)`,e.forEach(t=>{t.forEach(n=>{const o=document.createElement("div");o.className=`mini-cell ${n}`,E.monumentGrid.appendChild(o)})})}function z(){if(N.checkGameOver()&&!B){const i=N.getScore();E.finalScore.textContent=i.total.toString(),E.scoreList.innerHTML="";for(const[e,t]of Object.entries(i.breakdown))t!==0&&U(e,t);i.penaltyCount>0&&U("Empty Spaces",-i.penaltyCount,!0),E.gameOverModal.classList.remove("hidden")}}function U(i,e,t=!1){const n=document.createElement("li");n.className="score-item",t&&n.classList.add("penalty-text"),n.style.display="flex",n.style.justifyContent="space-between",n.style.marginBottom="5px",t&&(n.style.color="#ef5350",n.style.marginTop="10px",n.style.borderTop="1px solid #eee",n.style.paddingTop="5px"),n.innerHTML=`
        <span style="text-transform: capitalize;">${i.toLowerCase()}</span>
        <strong>${e}</strong>
    `,E.scoreList.appendChild(n)}j();
